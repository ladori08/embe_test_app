export type Locale = 'en' | 'vi';

export const LOCALE_STORAGE_KEY = 'embe-locale';

const dictionaries: Record<Locale, Record<string, string>> = {
  en: {
    'lang.en': 'EN',
    'lang.vi': 'VI',
    'nav.shop': 'Shop',
    'nav.admin': 'Admin',
    'nav.logout': 'Logout',
    'nav.login': 'Login',
    'nav.language': 'Language',
    'common.save': 'Save',
    'common.edit': 'Edit',
    'common.delete': 'Delete',
    'common.remove': 'Remove',
    'common.subtotal': 'Subtotal',
    'common.total': 'Total',
    'permission.checking': 'Checking permission...',
    'login.welcomeBack': 'Welcome Back',
    'login.subtitle': 'Use seeded accounts or your own credentials.',
    'login.email': 'Email',
    'login.password': 'Password',
    'login.failed': 'Login failed',
    'login.signingIn': 'Signing in...',
    'login.signIn': 'Sign in',
    'login.signedInAs': 'You are signed in as {email}',
    'shop.heroTag': 'Freshly Baked Daily',
    'shop.heroTitle': 'Warm pastries and coffee, crafted with care.',
    'shop.heroDesc': 'Embe blends artisan bakery favorites with cafe comfort. Pre-order online and pick up with ease.',
    'shop.cartCta': 'Cart ({count})',
    'shop.quickCheckout': 'Quick Checkout',
    'shop.title': 'Storefront',
    'shop.itemsCount': '{count} items',
    'shop.loading': 'Loading products...',
    'shop.empty': 'No active products yet.',
    'shop.stock': 'Stock {stock}',
    'shop.addToCart': 'Add to Cart',
    'shop.details': 'Details',
    'cart.title': 'Your Cart',
    'cart.empty': 'Cart is empty. Add items from the shop.',
    'cart.backToShop': 'Back to Shop',
    'cart.proceedToCheckout': 'Proceed to Checkout',
    'checkout.loading': 'Loading checkout...',
    'checkout.title': 'Checkout',
    'checkout.empty': 'Your cart is empty.',
    'checkout.tax': 'Tax',
    'checkout.placeOrder': 'Place Order',
    'checkout.placingOrder': 'Placing order...',
    'checkout.success': 'Order placed successfully. You can track it in your account/order list.',
    'checkout.failed': 'Checkout failed',
    'product.backToShop': 'Back to shop',
    'product.loading': 'Loading product...',
    'product.stock': 'Stock {stock}',
    'product.description': 'Crafted in-house with premium ingredients and a warm cafe touch.',
    'product.checkoutNow': 'Checkout Now',
    'drawer.title': 'Your Cart',
    'drawer.empty': 'Your cart is empty.',
    'drawer.checkout': 'Checkout',
    'admin.panel': 'Admin Panel',
    'admin.nav.dashboard': 'Dashboard',
    'admin.nav.ingredients': 'Ingredients',
    'admin.nav.products': 'Products',
    'admin.nav.recipes': 'Recipes',
    'admin.nav.production': 'Production',
    'admin.nav.orders': 'Orders',
    'admin.dashboard.loading': 'Loading dashboard...',
    'admin.dashboard.totalOrders': 'Total Orders',
    'admin.dashboard.revenue': 'Revenue',
    'admin.dashboard.estimatedProfit': 'Estimated Profit',
    'admin.dashboard.lowStock': 'Low Stock Ingredients',
    'admin.dashboard.statusMix': 'Order Status Mix',
    'admin.dashboard.revenue7d': 'Revenue Last 7 Days',
    'admin.ingredients.help': 'Manage base inventory and stock levels.',
    'admin.ingredients.add': 'Add Ingredient',
    'admin.ingredients.loading': 'Loading ingredients...',
    'admin.ingredients.empty': 'No ingredients yet.',
    'admin.ingredients.name': 'Name',
    'admin.ingredients.unit': 'Unit',
    'admin.ingredients.stock': 'Stock',
    'admin.ingredients.reorder': 'Reorder Threshold',
    'admin.ingredients.edit': 'Edit ingredient',
    'admin.ingredients.create': 'Add ingredient',
    'admin.ingredients.currentStock': 'Current stock',
    'admin.ingredients.reorderLevel': 'Reorder threshold',
    'admin.ingredients.costTracking': 'Cost tracking method',
    'admin.products.help': 'Manage products shown in storefront.',
    'admin.products.add': 'Add Product',
    'admin.products.loading': 'Loading products...',
    'admin.products.empty': 'No products yet.',
    'admin.products.name': 'Name',
    'admin.products.sku': 'SKU',
    'admin.products.price': 'Price',
    'admin.products.stock': 'Stock',
    'admin.products.status': 'Status',
    'admin.products.active': 'Active',
    'admin.products.hidden': 'Hidden',
    'admin.products.edit': 'Edit product',
    'admin.products.create': 'Add product',
    'admin.products.category': 'Category',
    'admin.products.cost': 'Cost',
    'admin.products.currentStock': 'Current stock',
    'admin.products.inactive': 'Inactive',
    'admin.recipes.failed': 'Failed to load data',
    'admin.recipes.tab.list': 'Recipes',
    'admin.recipes.tab.create': 'Create Recipe',
    'admin.recipes.empty': 'No recipes yet.',
    'admin.recipes.product': 'Product',
    'admin.recipes.yield': 'Yield',
    'admin.recipes.ingredients': 'Ingredients',
    'admin.recipes.yieldPerBatch': 'Yield per batch',
    'admin.recipes.selectIngredient': 'Select ingredient',
    'admin.recipes.qty': 'Qty',
    'admin.recipes.addLine': 'Add Ingredient Line',
    'admin.recipes.save': 'Save Recipe',
    'admin.production.help': 'Run bake jobs with transaction-safe stock mutation and idempotency key control.',
    'admin.production.yieldLabel': '{name} (yield {yieldQty})',
    'admin.production.batchFactor': 'Batch factor',
    'admin.production.run': 'Produce / Bake',
    'admin.production.success': 'Bake completed. Ingredient stock deducted and product stock increased.',
    'admin.production.failed': 'Failed to bake',
    'admin.production.history': 'Bake History',
    'admin.production.empty': 'No production records yet.',
    'admin.production.id': 'ID',
    'admin.production.recipe': 'Recipe',
    'admin.production.factor': 'Factor',
    'admin.production.produced': 'Produced',
    'admin.production.at': 'At',
    'admin.orders.empty': 'No orders available.',
    'admin.orders.order': 'Order',
    'admin.orders.user': 'User',
    'admin.orders.total': 'Total',
    'admin.orders.status': 'Status',
    'admin.orders.created': 'Created',
    'status.NEW': 'NEW',
    'status.CONFIRMED': 'CONFIRMED',
    'status.PAID': 'PAID',
    'status.CANCELLED': 'CANCELLED',
    'status.COMPLETED': 'COMPLETED'
  },
  vi: {
    'lang.en': 'EN',
    'lang.vi': 'VI',
    'nav.shop': 'Cửa hàng',
    'nav.admin': 'Quản trị',
    'nav.logout': 'Đăng xuất',
    'nav.login': 'Đăng nhập',
    'nav.language': 'Ngôn ngữ',
    'common.save': 'Lưu',
    'common.edit': 'Sửa',
    'common.delete': 'Xóa',
    'common.remove': 'Bỏ',
    'common.subtotal': 'Tạm tính',
    'common.total': 'Tổng cộng',
    'permission.checking': 'Đang kiểm tra quyền...',
    'login.welcomeBack': 'Chào mừng quay lại',
    'login.subtitle': 'Dùng tài khoản mẫu hoặc tài khoản của bạn.',
    'login.email': 'Email',
    'login.password': 'Mật khẩu',
    'login.failed': 'Đăng nhập thất bại',
    'login.signingIn': 'Đang đăng nhập...',
    'login.signIn': 'Đăng nhập',
    'login.signedInAs': 'Bạn đang đăng nhập với {email}',
    'shop.heroTag': 'Nướng mới mỗi ngày',
    'shop.heroTitle': 'Bánh nóng và cà phê, làm bằng sự chăm chút.',
    'shop.heroDesc': 'Embe kết hợp bánh thủ công và cà phê ấm cúng. Đặt trước online và nhận nhanh tại cửa hàng.',
    'shop.cartCta': 'Giỏ hàng ({count})',
    'shop.quickCheckout': 'Thanh toán nhanh',
    'shop.title': 'Cửa hàng',
    'shop.itemsCount': '{count} sản phẩm',
    'shop.loading': 'Đang tải sản phẩm...',
    'shop.empty': 'Chưa có sản phẩm đang bán.',
    'shop.stock': 'Tồn kho {stock}',
    'shop.addToCart': 'Thêm vào giỏ',
    'shop.details': 'Chi tiết',
    'cart.title': 'Giỏ hàng của bạn',
    'cart.empty': 'Giỏ hàng trống. Hãy thêm sản phẩm từ cửa hàng.',
    'cart.backToShop': 'Quay lại cửa hàng',
    'cart.proceedToCheckout': 'Tiếp tục thanh toán',
    'checkout.loading': 'Đang tải trang thanh toán...',
    'checkout.title': 'Thanh toán',
    'checkout.empty': 'Giỏ hàng của bạn đang trống.',
    'checkout.tax': 'Thuế',
    'checkout.placeOrder': 'Đặt hàng',
    'checkout.placingOrder': 'Đang đặt hàng...',
    'checkout.success': 'Đặt hàng thành công. Bạn có thể theo dõi trong danh sách đơn hàng.',
    'checkout.failed': 'Thanh toán thất bại',
    'product.backToShop': 'Quay lại cửa hàng',
    'product.loading': 'Đang tải sản phẩm...',
    'product.stock': 'Tồn kho {stock}',
    'product.description': 'Được làm tại bếp với nguyên liệu chất lượng và phong cách quán cafe ấm cúng.',
    'product.checkoutNow': 'Thanh toán ngay',
    'drawer.title': 'Giỏ hàng của bạn',
    'drawer.empty': 'Giỏ hàng của bạn đang trống.',
    'drawer.checkout': 'Thanh toán',
    'admin.panel': 'Bảng quản trị',
    'admin.nav.dashboard': 'Tổng quan',
    'admin.nav.ingredients': 'Nguyên liệu',
    'admin.nav.products': 'Sản phẩm',
    'admin.nav.recipes': 'Công thức',
    'admin.nav.production': 'Sản xuất',
    'admin.nav.orders': 'Đơn hàng',
    'admin.dashboard.loading': 'Đang tải tổng quan...',
    'admin.dashboard.totalOrders': 'Tổng đơn hàng',
    'admin.dashboard.revenue': 'Doanh thu',
    'admin.dashboard.estimatedProfit': 'Lợi nhuận ước tính',
    'admin.dashboard.lowStock': 'Nguyên liệu tồn thấp',
    'admin.dashboard.statusMix': 'Tỷ lệ trạng thái đơn',
    'admin.dashboard.revenue7d': 'Doanh thu 7 ngày',
    'admin.ingredients.help': 'Quản lý tồn kho nguyên liệu và ngưỡng cần nhập.',
    'admin.ingredients.add': 'Thêm nguyên liệu',
    'admin.ingredients.loading': 'Đang tải nguyên liệu...',
    'admin.ingredients.empty': 'Chưa có nguyên liệu.',
    'admin.ingredients.name': 'Tên',
    'admin.ingredients.unit': 'Đơn vị',
    'admin.ingredients.stock': 'Tồn',
    'admin.ingredients.reorder': 'Ngưỡng nhập lại',
    'admin.ingredients.edit': 'Sửa nguyên liệu',
    'admin.ingredients.create': 'Thêm nguyên liệu',
    'admin.ingredients.currentStock': 'Tồn hiện tại',
    'admin.ingredients.reorderLevel': 'Ngưỡng nhập lại (cảnh báo tồn thấp)',
    'admin.ingredients.costTracking': 'Cách tính giá vốn',
    'admin.products.help': 'Quản lý sản phẩm hiển thị trên cửa hàng.',
    'admin.products.add': 'Thêm sản phẩm',
    'admin.products.loading': 'Đang tải sản phẩm...',
    'admin.products.empty': 'Chưa có sản phẩm.',
    'admin.products.name': 'Tên',
    'admin.products.sku': 'SKU',
    'admin.products.price': 'Giá',
    'admin.products.stock': 'Tồn',
    'admin.products.status': 'Trạng thái',
    'admin.products.active': 'Đang bán',
    'admin.products.hidden': 'Ẩn',
    'admin.products.edit': 'Sửa sản phẩm',
    'admin.products.create': 'Thêm sản phẩm',
    'admin.products.category': 'Danh mục',
    'admin.products.cost': 'Giá vốn',
    'admin.products.currentStock': 'Tồn hiện tại',
    'admin.products.inactive': 'Ngừng bán',
    'admin.recipes.failed': 'Tải dữ liệu thất bại',
    'admin.recipes.tab.list': 'Công thức',
    'admin.recipes.tab.create': 'Tạo công thức',
    'admin.recipes.empty': 'Chưa có công thức.',
    'admin.recipes.product': 'Sản phẩm',
    'admin.recipes.yield': 'Sản lượng',
    'admin.recipes.ingredients': 'Nguyên liệu',
    'admin.recipes.yieldPerBatch': 'Sản lượng mỗi mẻ',
    'admin.recipes.selectIngredient': 'Chọn nguyên liệu',
    'admin.recipes.qty': 'Số lượng',
    'admin.recipes.addLine': 'Thêm dòng nguyên liệu',
    'admin.recipes.save': 'Lưu công thức',
    'admin.production.help': 'Chạy lệnh sản xuất với cập nhật tồn kho an toàn và idempotency key.',
    'admin.production.yieldLabel': '{name} (sản lượng {yieldQty})',
    'admin.production.batchFactor': 'Hệ số mẻ',
    'admin.production.run': 'Sản xuất / Nướng',
    'admin.production.success': 'Nướng thành công. Tồn nguyên liệu giảm và tồn sản phẩm tăng.',
    'admin.production.failed': 'Nướng thất bại',
    'admin.production.history': 'Lịch sử sản xuất',
    'admin.production.empty': 'Chưa có bản ghi sản xuất.',
    'admin.production.id': 'ID',
    'admin.production.recipe': 'Công thức',
    'admin.production.factor': 'Hệ số',
    'admin.production.produced': 'Sản lượng',
    'admin.production.at': 'Thời gian',
    'admin.orders.empty': 'Chưa có đơn hàng.',
    'admin.orders.order': 'Đơn',
    'admin.orders.user': 'Người dùng',
    'admin.orders.total': 'Tổng tiền',
    'admin.orders.status': 'Trạng thái',
    'admin.orders.created': 'Tạo lúc',
    'status.NEW': 'Mới',
    'status.CONFIRMED': 'Đã xác nhận',
    'status.PAID': 'Đã thanh toán',
    'status.CANCELLED': 'Đã hủy',
    'status.COMPLETED': 'Hoàn thành'
  }
};

export type TranslationParams = Record<string, string | number>;

export function isLocale(value: string | null | undefined): value is Locale {
  return value === 'en' || value === 'vi';
}

export function getInitialLocale(browserLanguage: string | undefined): Locale {
  if (browserLanguage?.toLowerCase().startsWith('vi')) {
    return 'vi';
  }
  return 'en';
}

export function translate(locale: Locale, key: string, params: TranslationParams = {}) {
  const template = dictionaries[locale][key] ?? dictionaries.en[key] ?? key;
  return template.replace(/\{(\w+)}/g, (_, paramKey: string) => String(params[paramKey] ?? `{${paramKey}}`));
}

export function formatMoneyByLocale(locale: Locale, value: number) {
  const numberLocale = locale === 'vi' ? 'vi-VN' : 'en-US';
  return new Intl.NumberFormat(numberLocale, { style: 'currency', currency: 'USD' }).format(value || 0);
}
